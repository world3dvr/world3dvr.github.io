<html>
<head>
<meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
<title>3D Game Design</title>
<script src="cannon.js"></script>
<script src="babylon.js"></script>
<script src="babylon.objFileLoader.min.js"></script>
<script>

</script>
<style>
    html, body {
overflow: hidden;
width: 100%;
height: 100%;
margin: 0;
padding: 0;
}
#renderCanvas {
width: 100%;
height: 100%;
touch-action: none;
}

</style>
<script>
function start() {
var canvas = document.getElementById('renderCanvas');
var engine = new BABYLON.Engine(canvas, true);

var keys = {};
window.addEventListener('keydown', function(e) {
keys[e.key] = true;
});

window.addEventListener('keyup', function(e) {
keys[e.key] = false;
});

var scene = new BABYLON.Scene(engine);
var gravityVector = new BABYLON.Vector3(0, -9.81, 0);
scene.enablePhysics(gravityVector, new BABYLON.CannonJSPlugin());

scene.clearColor = new BABYLON.Color3(0.5, 0.8, 0.5);
//===TRACK CODE===//

var _xFn = function(t) {var fns = [function(t) {return (Math.pow((1-t),3)*0.025)+(3*t*Math.pow((1-t),2)*0.36)+(3*Math.pow(t,2)*(1-t)*0.0725)+(Math.pow(t,3)*0.51)},function(t) {return (Math.pow((1-t),3)*0.51)+(3*t*Math.pow((1-t),2)*0.9475)+(3*Math.pow(t,2)*(1-t)*0.6225)+(Math.pow(t,3)*0.2125)},function(t) {return (Math.pow((1-t),3)*0.2125)+(3*t*Math.pow((1-t),2)*-0.1975)+(3*Math.pow(t,2)*(1-t)*0.47)+(Math.pow(t,3)*0.47)},function(t) {return (Math.pow((1-t),3)*0.47)+(3*t*Math.pow((1-t),2)*0.47)+(3*Math.pow(t,2)*(1-t)*0.54)+(Math.pow(t,3)*0.7625)},function(t) {return (Math.pow((1-t),3)*0.7625)+(3*t*Math.pow((1-t),2)*0.985)+(3*Math.pow(t,2)*(1-t)*0.9275)+(Math.pow(t,3)*0.675)},function(t) {return (Math.pow((1-t),3)*0.675)+(3*t*Math.pow((1-t),2)*0.4225)+(3*Math.pow(t,2)*(1-t)*0.0725)+(Math.pow(t,3)*0.58)},function(t) {return (Math.pow((1-t),3)*0.58)+(3*t*Math.pow((1-t),2)*1.0875)+(3*Math.pow(t,2)*(1-t)*0.495)+(Math.pow(t,3)*0.53)},function(t) {return (Math.pow((1-t),3)*0.53)+(3*t*Math.pow((1-t),2)*0.565)+(3*Math.pow(t,2)*(1-t)*0.105)+(Math.pow(t,3)*0.61)},function(t) {return (Math.pow((1-t),3)*0.61)+(3*t*Math.pow((1-t),2)*1.115)+(3*Math.pow(t,2)*(1-t)*0.35)+(Math.pow(t,3)*0.35)},function(t) {return (Math.pow((1-t),3)*0.35)+(3*t*Math.pow((1-t),2)*0.35)+(3*Math.pow(t,2)*(1-t)*0.0825)+(Math.pow(t,3)*0.2425)},function(t) {return (Math.pow((1-t),3)*0.2425)+(3*t*Math.pow((1-t),2)*0.4025)+(3*Math.pow(t,2)*(1-t)*0.7475)+(Math.pow(t,3)*0.06)},function(t) {return (Math.pow((1-t),3)*0.06)+(3*t*Math.pow((1-t),2)*-0.6275)+(3*Math.pow(t,2)*(1-t)*0.48)+(Math.pow(t,3)*0.4875)},function(t) {return (Math.pow((1-t),3)*0.4875)+(3*t*Math.pow((1-t),2)*0.495)+(3*Math.pow(t,2)*(1-t)*0.5775)+(Math.pow(t,3)*0.6725)},function(t) {return (Math.pow((1-t),3)*0.6725)+(3*t*Math.pow((1-t),2)*0.7675)+(3*Math.pow(t,2)*(1-t)*0.5)+(Math.pow(t,3)*0.9)},function(t) {return (Math.pow((1-t),3)*0.9)+(3*t*Math.pow((1-t),2)*1.3)+(3*Math.pow(t,2)*(1-t)*0.2375)+(Math.pow(t,3)*0.435)},function(t) {return (Math.pow((1-t),3)*0.435)+(3*t*Math.pow((1-t),2)*0.6325)+(3*Math.pow(t,2)*(1-t)*0.2125)+(Math.pow(t,3)*0.2125)},function(t) {return (Math.pow((1-t),3)*0.2125)+(3*t*Math.pow((1-t),2)*0.2125)+(3*Math.pow(t,2)*(1-t)*0.2075)+(Math.pow(t,3)*0.95)},function(t) {return (Math.pow((1-t),3)*0.95)+(3*t*Math.pow((1-t),2)*1.6925)+(3*Math.pow(t,2)*(1-t)*0.2275)+(Math.pow(t,3)*0.225)},function(t) {return (Math.pow((1-t),3)*0.225)+(3*t*Math.pow((1-t),2)*0.2225)+(3*Math.pow(t,2)*(1-t)*0.6675)+(Math.pow(t,3)*0.2175)},function(t) {return (Math.pow((1-t),3)*0.2175)+(3*t*Math.pow((1-t),2)*-0.2325)+(3*Math.pow(t,2)*(1-t)*0.675)+(Math.pow(t,3)*0.51)},function(t) {return (Math.pow((1-t),3)*0.51)+(3*t*Math.pow((1-t),2)*0.345)+(3*Math.pow(t,2)*(1-t)*0.5975)+(Math.pow(t,3)*0.5975)},function(t) {return (Math.pow((1-t),3)*0.5975)+(3*t*Math.pow((1-t),2)*0.5975)+(3*Math.pow(t,2)*(1-t)*0.635)+(Math.pow(t,3)*0.5825)},function(t) {return (Math.pow((1-t),3)*0.5825)+(3*t*Math.pow((1-t),2)*0.53)+(3*Math.pow(t,2)*(1-t)*0.0075)+(Math.pow(t,3)*0.69)},function(t) {return (Math.pow((1-t),3)*0.69)+(3*t*Math.pow((1-t),2)*1.3725)+(3*Math.pow(t,2)*(1-t)*0.685)+(Math.pow(t,3)*0.685)},function(t) {return (Math.pow((1-t),3)*0.685)+(3*t*Math.pow((1-t),2)*0.685)+(3*Math.pow(t,2)*(1-t)*0.2875)+(Math.pow(t,3)*0.2675)},function(t) {return (Math.pow((1-t),3)*0.2675)+(3*t*Math.pow((1-t),2)*0.2475)+(3*Math.pow(t,2)*(1-t)*0.25)+(Math.pow(t,3)*0.25)}];var i = Math.max(0,Math.min(25, Math.floor(t * 26)));return fns[i]((t - (i/26)) * 26);};
var _yFn = function(t) {var fns = [function(t) {return (Math.pow((1-t),3)*0.2)+(3*t*Math.pow((1-t),2)*0.8653125)+(3*Math.pow(t,2)*(1-t)*0.6803125)+(Math.pow(t,3)*0.6003125)},function(t) {return (Math.pow((1-t),3)*0.6003125)+(3*t*Math.pow((1-t),2)*0.5203125)+(3*Math.pow(t,2)*(1-t)*0.3378125)+(Math.pow(t,3)*0.4353125)},function(t) {return (Math.pow((1-t),3)*0.4353125)+(3*t*Math.pow((1-t),2)*0.5328125)+(3*Math.pow(t,2)*(1-t)*0.2603125)+(Math.pow(t,3)*0.2603125)},function(t) {return (Math.pow((1-t),3)*0.2603125)+(3*t*Math.pow((1-t),2)*0.2603125)+(3*Math.pow(t,2)*(1-t)*0.3053125)+(Math.pow(t,3)*0.3228125)},function(t) {return (Math.pow((1-t),3)*0.3228125)+(3*t*Math.pow((1-t),2)*0.3403125)+(3*Math.pow(t,2)*(1-t)*0.1128125)+(Math.pow(t,3)*0.1478125)},function(t) {return (Math.pow((1-t),3)*0.1478125)+(3*t*Math.pow((1-t),2)*0.1828125)+(3*Math.pow(t,2)*(1-t)*0.4078125)+(Math.pow(t,3)*0.1703125)},function(t) {return (Math.pow((1-t),3)*0.1703125)+(3*t*Math.pow((1-t),2)*-0.0671875)+(3*Math.pow(t,2)*(1-t)*0.9478125)+(Math.pow(t,3)*0.0803125)},function(t) {return (Math.pow((1-t),3)*0.0803125)+(3*t*Math.pow((1-t),2)*-0.7871875)+(3*Math.pow(t,2)*(1-t)*0.8178125)+(Math.pow(t,3)*0.6953125)},function(t) {return (Math.pow((1-t),3)*0.6953125)+(3*t*Math.pow((1-t),2)*0.5728125)+(3*Math.pow(t,2)*(1-t)*0.8528125)+(Math.pow(t,3)*0.8528125)},function(t) {return (Math.pow((1-t),3)*0.8528125)+(3*t*Math.pow((1-t),2)*0.8528125)+(3*Math.pow(t,2)*(1-t)*0.4753125)+(Math.pow(t,3)*0.7853125)},function(t) {return (Math.pow((1-t),3)*0.7853125)+(3*t*Math.pow((1-t),2)*1.0953125)+(3*Math.pow(t,2)*(1-t)*0.2353125)+(Math.pow(t,3)*0.5878125)},function(t) {return (Math.pow((1-t),3)*0.5878125)+(3*t*Math.pow((1-t),2)*0.9403125)+(3*Math.pow(t,2)*(1-t)*0.0603125)+(Math.pow(t,3)*0.4878125)},function(t) {return (Math.pow((1-t),3)*0.4878125)+(3*t*Math.pow((1-t),2)*0.9153125)+(3*Math.pow(t,2)*(1-t)*0.1928125)+(Math.pow(t,3)*0.5353125)},function(t) {return (Math.pow((1-t),3)*0.5353125)+(3*t*Math.pow((1-t),2)*0.8778125)+(3*Math.pow(t,2)*(1-t)*0.1878125)+(Math.pow(t,3)*0.4528125)},function(t) {return (Math.pow((1-t),3)*0.4528125)+(3*t*Math.pow((1-t),2)*0.7178125)+(3*Math.pow(t,2)*(1-t)*0.6553125)+(Math.pow(t,3)*0.2803125)},function(t) {return (Math.pow((1-t),3)*0.2803125)+(3*t*Math.pow((1-t),2)*-0.0946875)+(3*Math.pow(t,2)*(1-t)*0.3928125)+(Math.pow(t,3)*0.3928125)},function(t) {return (Math.pow((1-t),3)*0.3928125)+(3*t*Math.pow((1-t),2)*0.3928125)+(3*Math.pow(t,2)*(1-t)*0.6978125)+(Math.pow(t,3)*0.3178125)},function(t) {return (Math.pow((1-t),3)*0.3178125)+(3*t*Math.pow((1-t),2)*-0.0621875)+(3*Math.pow(t,2)*(1-t)*0.4653125)+(Math.pow(t,3)*0.2003125)},function(t) {return (Math.pow((1-t),3)*0.2003125)+(3*t*Math.pow((1-t),2)*-0.0646875)+(3*Math.pow(t,2)*(1-t)*0.5853125)+(Math.pow(t,3)*0.0178125)},function(t) {return (Math.pow((1-t),3)*0.0178125)+(3*t*Math.pow((1-t),2)*-0.5496875)+(3*Math.pow(t,2)*(1-t)*0.6678125)+(Math.pow(t,3)*0.3053125)},function(t) {return (Math.pow((1-t),3)*0.3053125)+(3*t*Math.pow((1-t),2)*-0.0571875)+(3*Math.pow(t,2)*(1-t)*0.6153125)+(Math.pow(t,3)*0.6153125)},function(t) {return (Math.pow((1-t),3)*0.6153125)+(3*t*Math.pow((1-t),2)*0.6153125)+(3*Math.pow(t,2)*(1-t)*0.2153125)+(Math.pow(t,3)*0.6053125)},function(t) {return (Math.pow((1-t),3)*0.6053125)+(3*t*Math.pow((1-t),2)*0.9953125)+(3*Math.pow(t,2)*(1-t)*0.3603125)+(Math.pow(t,3)*0.3928125)},function(t) {return (Math.pow((1-t),3)*0.3928125)+(3*t*Math.pow((1-t),2)*0.4253125)+(3*Math.pow(t,2)*(1-t)*0.3803125)+(Math.pow(t,3)*0.3803125)},function(t) {return (Math.pow((1-t),3)*0.3803125)+(3*t*Math.pow((1-t),2)*0.3803125)+(3*Math.pow(t,2)*(1-t)*0.8053125)+(Math.pow(t,3)*0.1603125)},function(t) {return (Math.pow((1-t),3)*0.1603125)+(3*t*Math.pow((1-t),2)*-0.4846875)+(3*Math.pow(t,2)*(1-t)*0.1453125)+(Math.pow(t,3)*0.1453125)}];var i = Math.max(0,Math.min(25, Math.floor(t * 26)));return fns[i]((t - (i/26)) * 26);};

//===END TRACK CODE===//

var xFn = function(t) { return 650 * _xFn(t); }
var zFn = function(t) { return 650 * _yFn(t); }


var playerSphere = BABYLON.MeshBuilder.CreateSphere("playerSphere", {
segments: 12,
diameter: 4
}, scene);
playerSphere.material = new BABYLON.StandardMaterial("playerSphereMaterial", scene);
playerSphere.material.diffuseTexture = new BABYLON.Texture('resources/download.jfif', scene);
playerSphere.position = new BABYLON.Vector3(xFn(0), 9, zFn(0));
playerSphere.physicsImpostor = new BABYLON.PhysicsImpostor(playerSphere, BABYLON.PhysicsImpostor.SphereImpostor, {
mass: 1,
restitution: 0.9
}, scene);

var camera = new BABYLON.ArcRotateCamera("Camera", 0, (3 * Math.PI) / 8, 20, playerSphere, scene);
camera.attachControl(canvas, true);
var light = new BABYLON.HemisphericLight('light1', new BABYLON.Vector3(0, 1, 0), scene);


scene.registerAfterRender(function() {
var vel = playerSphere.physicsImpostor.getLinearVelocity();
playerSphere.physicsImpostor.setLinearVelocity(vel.scale(.98));

var forward = camera.getFrontPosition(1).subtract(camera.position);
forward.y = 0;
forward = forward.normalize().scale(1);

var backward = BABYLON.Vector3.TransformCoordinates(forward, BABYLON.Matrix.RotationY(Math.PI));

var left = BABYLON.Vector3.TransformCoordinates(forward, BABYLON.Matrix.RotationY((3 * Math.PI) / 2));

var right = BABYLON.Vector3.TransformCoordinates(forward, BABYLON.Matrix.RotationY(Math.PI / 2));

if (keys.w ) {
playerSphere.applyImpulse(forward, playerSphere.getAbsolutePosition());
}
if (keys.s) {
playerSphere.applyImpulse(backward, playerSphere.getAbsolutePosition());
}
if (keys.a) {
playerSphere.applyImpulse(left, playerSphere.getAbsolutePosition());
}
if (keys.d) {
playerSphere.applyImpulse(right, playerSphere.getAbsolutePosition());
}
});


function drawPoint(x, z, zrot, scene) {
var point = BABYLON.MeshBuilder.CreateBox('point', {
width: 10,
height: 0.5,
depth: 12
}, scene);
point.material = new BABYLON.StandardMaterial("pointMaterial", scene);
point.material.diffuseColor = new BABYLON.Color3(1, 0, 1);
point.position = new BABYLON.Vector3(x, 0.1, z);
point.rotation.y = zrot;
point.physicsImpostor = new BABYLON.PhysicsImpostor(point, BABYLON.PhysicsImpostor.BoxImpostor, {
mass: 0,
restitution: 0.9
}, scene);
}
function drawParametric(xFn, zFn, start, end, res, scene) {
for (var t = start; t <= end; t += ((end - start) / res)) {
drawPoint(xFn(t), zFn(t), 0, scene);
}
}
drawParametric(xFn, zFn, 0, 1, 1500, scene);



engine.runRenderLoop(scene.render.bind(scene));
window.addEventListener('resize', engine.resize.bind(engine));
}


</script>


</head>
<body onload="start()">

<canvas id="renderCanvas"></canvas> 
</body>
</html>